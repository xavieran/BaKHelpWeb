<html>
<!-- Mirrored from notendur.hi.is/eybjorn/krondor/shopcode.html by HTTrack Website Copier/3.x [XR&CO'2006], Fri, 07 Jan 2011 19:18:16 GMT -->
<head><title>Betrayal at Krondor - Shop Assistant</title></head>
<body bgcolor=#000000 text=#cccccc link=#00ffff alink=#ffffff vlink=#00ffff>
<b><center>
<font size=+3 color=#ffff00>BETRAYAL AT KRONDOR - SHOP ASSISTANT</font><p>
<a href="shopmain.html">[Shop Home]</a><br>
<table border=0 width=100%>
<tr><td align=center>
<img src="hellfire.gif" width=50 height=34></td>
<td align=center nowrap><b>
<a href=#ite>[Items]</a>
<a href=#hag>[HAG]</a>
<a href=#gro>[Groups]</a>
<a href=#rep>[Repair]</a>
<a href=#pri>[Prices]</a>
<a href=#mat>[Maths]</a>
</td><td align=center>
<img src="rivetrap.gif" width=50 height=34>
</td></tr></table>
</center>
<blockquote>
<a name=ite>
<font size=+2 color=#00ffff>ITEMS</font><br>
Every Shop has an <font color=#00ffff>ITEMS</font> Code. Example - <font color=#00ffff>ITEMS 10/16.</font>
This means that 10 Items are initially for sale in the Shop, and that the 
Shop can hold a maximum of 16 Items. Why is this important?
<ul>
<li>
The 10 Items are CORE STOCK. The CORE STOCK will never change.
The Shop can only hold 16 Items. This means that you can SELL
6 Items to the Shop, all of which will then be for sale.<p>
If you now SELL a 7th Item to the Shop, something is bound to
happen. What happens is that one of the 6 Items you sold before
will disappear, only to be replaced by the 7th Item. From tests
I've made I'm fairly certain that the disappearing Item is ALWAYS
the MOST EXPENSIVE one of the 6 Bought Items. (Remember, this will
NOT affect CORE STOCK.)<p>
<li>
In a few cases the CORE STOCK will contain a HIDDEN ITEM. This
is usually a Medium Crossbow, which won't show up until Chapter 
3 (don't ask me why). In the example above (10/16), only 9 Items 
would show up in Chapters 1 and 2, but this won't change the fact 
that the Shop only has 6 empty Item slots.<p>
NOTE: The Hidden Item will be bought by the Shop, even if it
doesn't belong to an Item Group bought by the Shop. Example: The
Cavall Keep Shop does NOT buy all Crossbows. A Light Crossbow is
on sale here in all Chapters, but a Medium Crossbow will also turn
up here in Chapter 3. It is part of the CORE STOCK, and will be
bought by the Shop at all times, even in Chapter 1.<p>
<li>
Most Shops have 6 empty Item slots. However, some Shops have
a capacity for 50 Items! I can't see the logic behind this, as
the Shops in question only buy a VERY limited selection of
(cheap) Items. For your interest, the 50 Item Shops are:<p>
<font color=#00ffff>Tyr-Sog:</font><font color=#ff0000> Three Hillmen Pawn</font><br>
<font color=#00ffff>Tanneurs:</font><font color=#ff0000> Hamil's Pawn<br>
Et Cetera Goods <font color=#00ffff>(North of Cavall Keep)</font></font><p>
Perhaps the designers intended these Shops to be different?
Note that two of them are "PAWN" Shops!
</ul><p>
<a name=hag>
<font size=+2 color=#00ffff>HAG</font><br>
Each Shop has a <font color=#00ffff>HAG</font>gling Code. Example - <font color=#00ffff>HAG 75/40.</font> You should 
ignore these numbers, unless you're passionately interested in cracking 
codes (and have a lot of time on your hands)! I've spent awesome
amounts of time trying to figure out the exact mechanisms of
HAGGLING, and all I really know is that there is a RANDOM FACTOR
involved. I'm convinced that these two numbers contain the solution,
so I've decided to include them here, for future reference.<p> 
If you're interested in tackling this enigma, let me know. I have
SOME info to share. But let me warn you: You need to be prepared to
spend WEEKS, if not MONTHS, on TESTING alone, collecting MOUNTAINS
of Data. And then you'd have
to figure out the mathematics involved. (Note: I managed to solve
the BARDING puzzle by pure luck, and only because there's no RANDOM
FACTOR involved.)<p>
<a name=gro>
<font size=+2 color=#ffff00>ITEM GROUPS</font><br>
On each Shop Page you will come across the <font color=#ffff00>Item Group Codes.</font>
These are three-letter codes I use for the Item Groups. Each
Shop will buy one or more Item Group. If you check out the
<a href="basic.html">Basic Prices Page</a>, you will see that I've classified all the
items according to these Groups. Here's a quick check-list
of the 12 Groups you will come across on the Shop Pages. If
you need further details, go to the <a href="basic.html">Basic Prices Page</a>.<p>
</b>
<tt><font size=+1>
<ul>
<li><font color=#ffff00>MOD</font> - Weapon/Armor <font color=#ffff00>Mod</font>ifiers (incl. Coltari Poison)
<li><font color=#ffff00>POT</font> - <font color=#ffff00>Pot</font>ions (incl. Herbal Packs)
<li><font color=#ffff00>BOK</font> - <font color=#ffff00>Bo</font>o<font color=#ffff00>k</font>s (excl. Journals)
<li><font color=#ffff00>STA</font> - <font color=#ffff00>Sta</font>ffs (excl. Crystal Staff)
<li><font color=#ffff00>MAG</font> - <font color=#ffff00>Mag</font>ical Items 
<li><font color=#ffff00>ARM</font> - <font color=#ffff00>Arm</font>or (excl. Valheru Armor) 
<li><font color=#ffff00>CRO</font> - <font color=#ffff00>Cro</font>ssbows, Quarrels & Bowstrings 
<li><font color=#ffff00>SWO</font> - <font color=#ffff00>Swo</font>rds 
<li><font color=#ffff00>COM</font> - <font color=#ffff00>Com</font>bat Items (Potio Noxum, Powder Bag, Tuning Fork)
<li><font color=#ffff00>GEM</font> - <font color=#ffff00>Gem</font>stones
<li><font color=#ffff00>RAT</font> - <font color=#ffff00>Rat</font>ions
<li><font color=#ffff00>OTH</font> - <font color=#ffff00>Oth</font>er Items (see Basic Price Page)
</ul><p></font></tt><b>
There are four more Item Groups, which you should be familiar
with:<p></b>
<tt><font size=+1>
<ul>
<li><font color=#ffff00>NON</font> - <font color=#ffff00>Non</font>-Saleable Items
<li><font color=#ffff00>SPE</font> - Magical Scrolls (<font color=#ffff00>Spe</font>lls)
<li><font color=#ffff00>KEY</font> - <font color=#ffff00>Key</font>s
<li><font color=#ffff00>INN</font> - <font color=#ffff00>Inn</font> Items (Ale, Brandy)
</ul></tt></font><p><b>
It is useful to know which Items belong to the <font color=#ffff00>NON</font> Group - these
Items can NEVER be sold. <font color=#ffff00>SPE</font>lls can only be sold in Shops
that already have them for sale. <font color=#ffff00>KEY</font>s and <font color=#ffff00>INN</font> Items can, of course
never be sold anywhere.<p>
A Shop will always buy ANY ITEM from the specified
Group. It will also buy all items ALREADY FOR SALE,
even if they're not in the GROUP. Example:<p><blockquote>
A Shop does NOT buy the <font color=#ffff00>SWO</font>rd group, but a Broadsword
is for sale. This means that you can SELL a Broadsword
here, but NO OTHER SWORD.<p></blockquote>
For a rough overview of Shops and the Item Groups bought you should consult
the <a href="itmgroup.html">ITEM GROUP TABLE</a>.<p>
<a name=rep>
<font size=+2 color=#ff0000>REPAIR </font>
 (Special thanks to Bob Freimuth, who researched this and figured out the maths.)<p>
Only 6 Shops in the game offer Repair:<p>

<table border=1 cellspacing=10>
<tr><td><b><font size=+1 color=#ff0000>SHOP</td><td><b><font size=+1 color=#ff0000>REPAIR</td><td><b><font size=+1 color=#ff0000>RF</td></tr>
<tr><td><b><font color=#ff0000>Fletcher's Post (LaMut)</td><td><b><font color=#ff0000>Crossbows</td><td align=right><b><font color=#ff0000>N/A</td></tr>
<tr><td><b><font color=#ff0000>Joseph the Animal's</td><td><b><font color=#ff0000>Armor</td><td align=right><b><font color=#ff0000>0.8</td></tr>
<tr><td><b><font color=#ff0000>The Battleworks (Highcastle)</td><td><b><font color=#ff0000>All</td><td align=right><b><font color=#ff0000>0.5</td></tr>
<tr><td><b><font color=#ff0000>The Iron Monger (Northwarden)</td><td><b><font color=#ff0000>All</td><td align=right><b><font color=#ff0000>1.0</td></tr>
<tr><td><b><font color=#ff0000>Sign of the Eagle (Krondor)</td><td><b><font color=#ff0000>All</td><td align=right><b><font color=#ff0000>1.0</td></tr>
<tr><td><b><font color=#ff0000>Port Exchange (Romney)</td><td><b><font color=#ff0000>All</td><td align=right><b><font color=#ff0000>1.0</td></tr>
</table><p>

The cost of repair usually depends upon three factors:
The Basic Price of the Item, the Condition of the Item,
and the Repair Factor (<font color=#ff0000>RF</font>, see above).<p>
Crossbows are different. There's just a flat rate,
80.0 for a Bessy Mauler, 40.0 for all others. Note: A Broken 
Crossbow needs to be RESTRINGED - Heavy String for Bessy Mauler
and Tsurani Heavy Crossbow, Light Bowstring for all others.
Restringing always results in 100% condition, thus Repairing
a Broken Bow in a Shop is a waste of money.<p>

The formula for calculating the cost of repairing Swords and
Armor is given below, where the
Item's Condition is expressed 
as <font color=#ffff00>0.XX</font> (for example, <font color=#ffff00>25%</font> = <font color=#ffff00>0.25</font>).<p>
<blockquote>
<font color=#ffff00>Repair Cost = Basic Price * Repair Factor * (1 - Condition)</font><p>
For example, the cost of repairing a 25% Broadsword (Basic Price = 12.0) in 
Romney (Repair Factor = 1.0) would be:<p>
<blockquote>
<font color=#ffff00>12.0 * 1.0 * (1 - 0.25) = 9.0</font><p></blockquote>
The cost of repairing the same sword in Highcastle (Repair Factor = 0.5) would be:<p>
<blockquote>
<font color=#ffff00>12.0 * 0.5 * (1 - 0.25) = 4.5</font></blockquote><p></blockquote>
<a name=pri>
<font size=+2>PRICES: <font color=#ff00ff>BASIC</font> / <font color=red>SELL</font> / <font color=green>BUY</font> / <font color=blue>DISCOUNT</font></font><br>
Each Item has a <font color=#ff00ff>Basic Price</font>. You can look this up in the
<a href="basic.html">Basic Prices Page</a>. In each shop the Basic Price will be
modified. There are three factors to look out for here:
The <font color=red>SELL Factor</font>, the <font color=green>BUY Factor</font>,
and the <font color=blue>Maximum Discount.</font> Please pay attention to the
COLORS - they are used consistently in the Shop Pages.<p>
This is best illustrated with an example. Let's look at THE CROSSROADS Shop
in Yabon. Here's an actual part of this Shop Page:<p>
<center>
<table border=1 cellpadding=5>
<tr><td colspan=2 align=left><b><font size=+1 color=#00ff00>THE CROSSROADS <img src="transp.gif" width=50 height=5><font color=red><b>1.30</font> <font color=blue><b>25% </font><font color=green><b>0.27</font><td align=center><b><font color=#ff00ff>BASIC</td><td align=center><b><font color=red>SELL</td><td align=center><b><font color=green>BUY</td></tr>
<tr>
<td align=center><img src="brdswrd.gif" width=89 height=45></td>
<td align=center><b><font color=#00ffff>Broadsword [100%]</td>
<td align=center><b><font color=#ff00ff>12.0</font></td>
<td align=center><font color=red><b>15.6 <img src="transp.gif" width=5 height=5><font color=blue>11.7</td>
<td align=center><font color=green><b>4.2</td></tr>
</table></center><p>

There's a <font color=#00ffff>100% Broadsword</font> for sale here. The <font color=#ff00ff>Basic Price</font>
for this is <font color=#ff00ff>12.0.</font> The actual <font color=red>SELL Price</font> is found by multiplying
<font color=#ff00ff>this</font> with the <font color=red>SELL Factor:</font>
<blockquote>
<font color=#ff00ff>12.0</font> * <font color=red>1.3</font> = <font color=red>15.6</font>
</blockquote><p>
However, if you sell the same <font color=#00ffff>Sword</font> back, you will only
receive <font color=green>4.2</font> for it! Now the <font color=green>BUY Factor</font> comes into account.
The <font color=red>SELL Price</font> multiplied by the <font color=green>BUY Factor</font> results in the
<font color=green>BUY Price:</font>
<blockquote><p>
<font color=red>15.6</font> * <font color=green>0.27</font> = <font color=green>4.212</font>, which gets truncated to <font color=green>4.2</font>
</blockquote><p>

As you know, it is possible to Haggle. I haven't been able to
figure out the exact mechanisms of Haggling (see above), because
there's a Random Factor in the equation, which makes it extremely
difficult to test. However, I've established the <font color=blue>Maximum Discount.</font>
In this example the <font color=blue>Maximum Discount</font> is <font color=blue>25%</font>, which means that <font color=blue>11.7</font>
is the lowest possible price you can achieve by Haggling in this
Shop:<p>
<blockquote>
<font color=red>15.6</font> - (<font color=red>15.6</font> * <font color=blue>0.25</font>) = <font color=blue>11.7</font>
</blockquote><p>
In this example the Haggle Price could fall anywhere beween
11.7 and 15.6, depending on your Haggling Skill and LUCK (the
Random Factor). (Note: Because of the Random Factor it is possible
to exit a Shop, re-enter, and Haggle again with a different result!)<p>
</blockquote>
<ul>
<li>
Note: The <font color=green>BUY Price</font> for ARMOR is ALWAYS half of the expected
Price, i.e.<p>
<blockquote>
(<font color=red>Sell Price</font> * <font color=green>Buy Factor</font>) / 2
</blockquote><p>
<li>
Note: The <font color=red>SELL Price</font> of Magical Scrolls is always the same
as the <font color=#ff00ff>BASIC Price.</font> The <font color=red>SELL Factor</font> doesn't apply here.<p>
<li>
Note: Although Weapon/Armor Modifiers do not affect Prices, Blessings will!
<blockquote>
A <font color=blue>#1 Blessing</font> will increase the Price by <font color=black>0</font>50% (multiply with 1.50)<br>
A <font color=yellow>#2 Blessing</font> will increase the Price by <font color=black>0</font>75% (multiply with 1.75)<br>
A <font color=red>#3 Blessing</font> will increase the Price by 100% (multiply with 2.00)
</blockquote>
</ul><p>
<a name=mat>
<blockquote>
<font size=+2 color=#00ffff>BAK MATHEMATICS</font><br>
When calculating any of the above, it is
sometimes important to realize how the game calculates. If you're
a pedant (like me), you will get extremely irritated (and suspicious)
if a calculated result is off by so much as a single Silver Royal!
So here's a crash course in BAK Mathematics:<p>

<font size=+1 color=#00ffff>TRUNCATION OF NUMBERS</font><br>
BAK only admits ONE Decimal Place. Numbers are NEVER rounded up, only
truncated.<p>
<blockquote>
For instance,
BAK will treat 1.99 as 1.9, 1.09 as 1.0 (even though
1.99 is closer to 2.0, and 1.09 is closer to 1.1).<p>
</blockquote>

<font size=+1 color=#00ffff>CALCULATIONS</font><br>

All Prices are calculated from the Basic Price. Therefore it is
necessary to know that the Basic Price of any Item is based on
a certain Charge/Percentage of that Item. (This information can
easily be found in the <a href="basic.html">BASIC PRICES Page</a>.)<p>

So let's look at an example of how this can matter:<p>
<blockquote>
SHOP: Children of the Green Heart <font color=red>SELL Factor: 1.15</font><br>
On sale here are <font color=#00ffff>Picklocks [8]</font> - <font color=#ff00ff>Basic 70.0 </font><font color=red>Sell 80.4</font><p>
Now, according to the formula given above (Basic Price * Sell Factor = Sell Price)<br><font color=#ff00ff>70.0</font> * <font color=red>1.15</font> = <font color=red>80.5</font>! So why is it actually <font color=red>80.4?</font><p>
The Basic Price of Picklocks is based on <font color=#00ffff>Picklocks [4]</font> = <font color=#ff00ff>35.0</font>
This, of course,
results in a <font color=#ff00ff>Basic Price</font> of <font color=#ff00ff>70.0</font> for <font color=#00ffff>Picklocks [8].</font><p>
In this Shop the price of <font color=#00ffff>Picklocks [4]</font> would 
be <font color=#ff00ff>35.0</font> * <font color=red>1.15</font> = <font color=red>40.25</font>,
and the game truncates this to <font color=red>40.2</font>, resulting in a <font color=red>SELL Price</font> of
<font color=red>80.4</font> for <font color=#00ffff>Picklocks [8]</font>!<p>
</blockquote>
The same applies to Weapons/Armor in less than 100% condition, the <font color=#ff00ff>Basic Price</font>
being based on 100% condition. Here the obvious rule is:<p>
<blockquote>
First find out what a 100% Item would cost in the Shop (<font color=#ff00ff>Basic Price</font> * <font color=red>Sell Factor</font>). Truncate
the result, if needed. Then apply the condition.
</blockquote><p>

When doing Price calculations in BAK, remember two facts:<p>

1) The <font color=green>BUY Price</font> is calculated from the <font color=red>SELL Price.</font>
The <font color=red>SELL Price</font> is calculated from the <font color=#ff00ff>BASIC Price</font>.
If you calculate the <font color=green>BUY Price</font> from the <font color=#ff00ff>BASIC Price</font>,
remember that the <font color=red>SELL Price</font> must be TRUNCATED before it is multiplied with the <font color=green>BUY Factor.</font><p>


2) As stated above, the equation for Maximum Discount is:
<blockquote>
<font color=red>SELL PRICE</font> - (<font color=red>SELL PRICE</font> * 0.XX)
</blockquote><p>
Algebraically this is, of course, equal to:<p>
<blockquote>
<font color=red>SELL PRICE</font> * (1 - 0.XX)
</blockquote><p>
   But there a catch! The Discount (<font color=red>SELL PRICE</font> * 0.XX) must be TRUNCATED,
   before it is subtracted from the <font color=red>SELL PRICE</font> !<p>
<blockquote>
   Example: <font color=red>ITEM SELL PRICE: 65.0</font> / <font color=blue>Maximum Discount: 25%</font><p>
   <font color=red>65.0</font> * (1 - 0.25) = 48.75 = 48.7 (truncation) (WRONG!)<p>
   BUT<p>

   <font color=red>65.0</font> * <font color=blue>0.25</font> = 16.25 = 16.2 (truncation)<br>
   <font color=red>65.0</font> - 16.2 = <font color=blue>48.8</font> (CORRECT!)<p>
</blockquote></blockquote>
Is there anything else left to explain? Perhaps there is. You will find more information
in the other <a href="shopmain.html">Shop Pages</a>, but I'm sure I've missed something. If you're puzzled, please
let me know.<p>
</body>
<!-- Mirrored from notendur.hi.is/eybjorn/krondor/shopcode.html by HTTrack Website Copier/3.x [XR&CO'2006], Fri, 07 Jan 2011 19:18:16 GMT -->
</html>


   



